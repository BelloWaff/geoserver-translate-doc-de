
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Primary key generation &mdash; GeoServer 2.2.x Developer Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x Developer Manual" href="../../../index.html" />
      <link rel="up" title="Versioning" href="../index.html" />
      <link rel="next" title="Database tables" href="dbschema.html" />
      <link rel="prev" title="Core synchronization protocol" href="protocol.html" />
</head>
<body class="programming-guide/versioning/gss/primarykey">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Programming Guide</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Versioning</a> &raquo;</li>
  <li>Primary key generation</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="dbschema.html" title="Database tables"
       accesskey="N">next</a></li>
  <li>
    <a href="protocol.html" title="Core synchronization protocol"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="primary-key-generation">
<span id="versioning-gss-pk"></span><h1>Primary key generation<a class="headerlink" href="#primary-key-generation" title="Permalink to this headline">¶</a></h1>
<p>Primary key generation is happening all over the distributed network, features generated in the various nodes will eventually be merged in Central and distribute to the rest of the units.</p>
<p>This means the system has to make sure no two primary key will ever conflict. This section discusses three possible algorithms for conflict avoidance</p>
<div class="section" id="guid-based">
<h2>GUID based<a class="headerlink" href="#guid-based" title="Permalink to this headline">¶</a></h2>
<p>Most distributed version control systems (Git, Mercurial) use Globally Unique Identifiers (GUID) to mark items that have to be uniquely identified across the distributed network.</p>
<p>A GUID is a 128bit number generated by an algorithm providing uniqueness guarantees across a distributed network. Often, but not always, the algorithm uses the Ethernet card MAC address and a very precise notion of the current time to generate such identifier.</p>
<p>The positive side of this approach is that it does not require any configuration nor synchronization protocol modifications, the downside is that the generated number is long and hard to read.</p>
</div>
<div class="section" id="explicit-discriminator">
<h2>Explicit discriminator<a class="headerlink" href="#explicit-discriminator" title="Permalink to this headline">¶</a></h2>
<p>An explicit discriminator approach uses a locally unique number (such as the one generated by a local sequence) plus a separate identifier for the Unit. Assuming unitId is a number the following expression will generate unique ids:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">unitId</span> <span class="o">*</span> <span class="mi">1000000000000</span> <span class="o">+</span> <span class="n">localSequenceValue</span>
</pre></div>
</div>
<p>This expression generates 128bit numbers just like a GUID, allows for up to one million different units, and makes it possible to know which unit generated a certain feature by just looking at the identifier. The main downside is that it requires configuration of a unique unitId, if by mistake two Units are configured with the same id the synchronization will consistently fail.</p>
</div>
<div class="section" id="central-replacement">
<h2>Central replacement<a class="headerlink" href="#central-replacement" title="Permalink to this headline">¶</a></h2>
<p>In this approach all units will generate locally unique ids using sequences. When the synchronization happens the GSS in central will look at the newly inserted features and generate a new unique identifier based on one or more local sequences, and then send back to the Unit a replacement id for each feature.</p>
<p>The advantage of this approach is lack of configuration and the usage of standard 64 bit sequences.</p>
<p>There are two significant downsides to this approach:</p>
<ul class="simple">
<li>It makes the synchronization protocol more complex, and makes it harder to cleanly restart in face of network communication issues. An extra call is required, as well as the storage of the id replacement table in order to restart the protocol shall this extra exchange fail to take place due to a network issue.</li>
<li>If the synchronization happens as a user is still editing the features the change of id will break the user edits requiring a restart of the operation with consequent time lost and user frustration.</li>
</ul>
</div>
<div class="section" id="chosen-implementation">
<h2>Chosen implementation<a class="headerlink" href="#chosen-implementation" title="Permalink to this headline">¶</a></h2>
<p>The system will be initially implemented along the GUID approach, which guarantees key uniqueness with the least effort and the best guarantees of proper operation.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="protocol.html" title="previous chapter">Core synchronization protocol</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="dbschema.html" title="next chapter">Database tables</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Primary key generation</a><ul>
<li><a class="reference internal" href="#guid-based">GUID based</a></li>
<li><a class="reference internal" href="#explicit-discriminator">Explicit discriminator</a></li>
<li><a class="reference internal" href="#central-replacement">Central replacement</a></li>
<li><a class="reference internal" href="#chosen-implementation">Chosen implementation</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="protocol.html" title="previous chapter">Core synchronization protocol</a></li>
            <li>Next: <a href="dbschema.html" title="next chapter">Database tables</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../../_sources/programming-guide/versioning/gss/primarykey.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2011 GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
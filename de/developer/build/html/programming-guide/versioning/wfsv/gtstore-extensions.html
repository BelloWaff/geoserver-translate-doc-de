
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Versioning WFS - GT2 Datastore extensions &mdash; GeoServer 2.2.x Developer Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x Developer Manual" href="../../../index.html" />
      <link rel="up" title="Versioning implementation" href="implementation.html" />
      <link rel="next" title="WFS Extensions" href="wfs-extensions.html" />
      <link rel="prev" title="Datastore design" href="dbschema.html" />
</head>
<body class="programming-guide/versioning/wfsv/gtstore-extensions">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Programming Guide</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Versioning</a> &raquo;</li>
  <li><a href="implementation.html" accesskey="U">Versioning implementation</a> &raquo;</li>
  <li>Versioning WFS - GT2 Datastore extensions</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="wfs-extensions.html" title="WFS Extensions"
       accesskey="N">next</a></li>
  <li>
    <a href="dbschema.html" title="Datastore design"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="versioning-wfs-gt2-datastore-extensions">
<span id="versioning-implementation-gtstore"></span><h1>Versioning WFS - GT2 Datastore extensions<a class="headerlink" href="#versioning-wfs-gt2-datastore-extensions" title="Permalink to this headline">¶</a></h1>
<p>Versioning requires some changes on the datastore interface.</p>
<div class="section" id="schema-handling">
<h2>Schema handling<a class="headerlink" href="#schema-handling" title="Permalink to this headline">¶</a></h2>
<p>Assuming that a vesioned datastore is able to handle both versioned and non versioned feature types and that it can make them change state, the following additions to FeatureType getSchema(String) and String[] getTypeNames() in order to chech wheter a type is versioned, and in order to transition it between the versioned and non versioned states:</p>
<div class="highlight-python"><pre>boolean isVersioned(String typename) throws IOException;
void setVersioned(String typename) throws IOException;</pre>
</div>
<p>setVersioned should be optional, throwing UnsupportedOperationException on datastore that do not provide it, and an IOException in the case where it does not make sense to version a feature type, such as the ChangeSet one, which is used to provide logging (see Versioning WFS - Database design).</p>
</div>
<div class="section" id="data-gathering">
<h2>Data gathering<a class="headerlink" href="#data-gathering" title="Permalink to this headline">¶</a></h2>
<p>Querying the datastore should take versioning into account.</p>
<p>The Query interface already provides a String getVersion which is WFS standard compliant. If no version is provided, the latest version will be assumed.</p>
<p>We&#8217;ll use it, thought it would be nice to expand its semantics to take care of branches and time based extractions:</p>
<ul class="simple">
<li>&#8220;1024&#8221;: extract revision 1024</li>
<li>&#8220;projectX:1024&#8221;: extract revision 1024 from branch &#8220;projectX&#8221;</li>
<li>&#8220;20061203122500&#8221;: time based extraction using ISO like format (December 12 2006, 12:25:00)</li>
<li>&#8220;projectX:20061203122500&#8221;: as above, with branch specification.</li>
</ul>
</div>
<div class="section" id="data-writing">
<h2>Data writing<a class="headerlink" href="#data-writing" title="Permalink to this headline">¶</a></h2>
<p>Here things get messier. Write side of the world does not have any notion of versioning, since Query is basically not used at all in the writing interfaces (nor DataStore, nor FeatureStore).
Moreover, here both version and user id shall be provided in order to perform the operation against a versioned datastore.</p>
<p>The best guess I have at the moment is to leverage the Transaction inteface, and in particular the Transaction properties, thus making revision we&#8217;re working against and user id two &#8220;well known&#8221; transaction properties the versioned datastore should use.
If the two above are not available the versioned datastore can either fall back on some default user provided during datastore instantiation and last revision, or throw an exception.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="dbschema.html" title="previous chapter">Datastore design</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="wfs-extensions.html" title="next chapter">WFS Extensions</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Versioning WFS - GT2 Datastore extensions</a><ul>
<li><a class="reference internal" href="#schema-handling">Schema handling</a></li>
<li><a class="reference internal" href="#data-gathering">Data gathering</a></li>
<li><a class="reference internal" href="#data-writing">Data writing</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="dbschema.html" title="previous chapter">Datastore design</a></li>
            <li>Next: <a href="wfs-extensions.html" title="next chapter">WFS Extensions</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../../_sources/programming-guide/versioning/wfsv/gtstore-extensions.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2011 GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
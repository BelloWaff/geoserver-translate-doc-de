
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Versioning WFS - ArcSDE &mdash; GeoServer 2.2.x Developer Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x Developer Manual" href="../../../index.html" />
      <link rel="up" title="Versioning implementations" href="implementations.html" />
      <link rel="next" title="OpenStreetMap" href="osm.html" />
      <link rel="prev" title="Oracle Worskspace Manager" href="oracle.html" />
</head>
<body class="programming-guide/versioning/wfsv/arcsde">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.2.x Developer Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Programming Guide</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Versioning</a> &raquo;</li>
  <li><a href="implementations.html" accesskey="U">Versioning implementations</a> &raquo;</li>
  <li>Versioning WFS - ArcSDE</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="osm.html" title="OpenStreetMap"
       accesskey="N">next</a></li>
  <li>
    <a href="oracle.html" title="Oracle Worskspace Manager"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="versioning-wfs-arcsde">
<span id="versioning-implementations-arcsde"></span><h1>Versioning WFS - ArcSDE<a class="headerlink" href="#versioning-wfs-arcsde" title="Permalink to this headline">¶</a></h1>
<p>ArcSDE is a forward change feature version system, capable of handling multiple branches, and based on a set of database tables.
The standard parlance in ArcSDE is a little different than the one used in SVN:</p>
<ul class="simple">
<li>version: branch/trunch/tag, that is, the equivalent of an svn copy. Trunk is called the &#8220;default&#8221; version;</li>
<li>state: revision</li>
<li>post a version B to version A: perform a merge of changes occurred in B onto A, where B was branched off earlier. This usually also closes version B.</li>
</ul>
<p>In ArcSDE states are maintained as sets of adds and deletes to the initial state of data, and each add or update is a full copy, not a diff.</p>
<p>The following diagram provides a picture of entities involved into versioning.</p>
<img alt="../../../_images/sde.jpg" src="../../../_images/sde.jpg" />
<p>Each &#8220;version&#8221; is identified by a name and owned by some user. The access level may be private (only the owner can read and write), protected (only the owner can write) or public.
Each version has a parent, and it can be posted back to that parent once done (I haven&#8217;t seen examples of posting to another version, don&#8217;t know if it&#8217;s possible).</p>
<p>Each version refers a state, which is in turn a set of modifications on the feature set, and has a parent state, thus building a tree of states. Each state hold modifications for a number of features, and the list of feature tables modified in a certain state is held in the ModifiedTables associated records.</p>
<p>Both version and state do refer a lineage, which the documentation does not comment much about. Anyways, since an efficient way to look up the ancestors of a given state or version is needed, lineage probably stores an ancestors path or a similar way to encode a hierarchy. For example, version 6 lineage may be something like 0.1.2.6. For a discussion of ways to encode a hierarchy in a sql database refer to the DBAzine article &#8220;Nested sets and materialized paths&#8221;.</p>
<img alt="../../../_images/sdetree.png" src="../../../_images/sdetree.png" />
<p>For each feature table &#8220;FeatureX&#8221; in the database, we do have a AddFeatureX table whose structure is the same as the feature table table, along with a reference to the state the record is associated to, and a DelFeatureX, which holds just a reference to the deleted object, along with the last state where the object was alive, and the state where the object has been deleted.
For each added feature, a record appears in the AddFeatureX table, for each deleted feature a record appears in the DelFeatureX table, and for each updated feature a record appears in both tables.</p>
<p>The record in the AddFeatureX tables always represents the new full state of a feature, so no delta computation is performed: this allows a faster retrieval of current state at the expense of extra space consumption. On the bright side, the features at a certain state can be retrieved with a single SQL query. Assuming the state ancestry is maintained with the materialized path method, the query would look like:</p>
<div class="highlight-python"><pre>select id, att1, ... attn
from FeatureX
where id not in (
   select id
   from DelFeatureX, States
   where DelFeatureX.stateId = States.id
   and States.lineage in ('0', '0.1', '0.1.2', '0.1.2.6')
)
union
select id, att1, ...., attn
from AddFeatureX, States
where AddFeatureX.state_id =
(
   select max(state_id)
   from AddFeatureX af2
   where af2.id = AddFeatureX.id
)
and AddFeatureX.state_id = States.id
and States.lineage in ('0', '0.1', '0.1.2', '0.1.2.6')
and AddFeatureX.id not in (
   select id
   from DelFeatureX, States
   where DelFeatureX.stateId = States.id
   and States.lineage in ('0', '0.1', '0.1.2', '0.1.2.6')
   and DelFeatureX.stateId &lt;&gt; AddFeatureX.stateId
)</pre>
</div>
<p>that is, all original features that have not been updated of deleted during the states history, union the last record of all features that have been added or updated, and not been deleted during the states history.</p>
<p>Here we suppose we know the lineage of the state and that we won&#8217;t incur in sql length problems... this is a little naïve of course, an alternative would be to keep full ancetry information in a separate table that can be quied, allowing from something like &#8220;state_id in (select parent from state_hierarchy where child = current_state_id))&#8221;. Of course such a table is bound to become very big.</p>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="oracle.html" title="previous chapter">Oracle Worskspace Manager</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="osm.html" title="next chapter">OpenStreetMap</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="oracle.html" title="previous chapter">Oracle Worskspace Manager</a></li>
            <li>Next: <a href="osm.html" title="next chapter">OpenStreetMap</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../../_sources/programming-guide/versioning/wfsv/arcsde.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2011 GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
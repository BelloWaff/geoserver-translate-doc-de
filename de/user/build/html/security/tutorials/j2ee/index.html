
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Configuring J2EE Authentication &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../../../index.html" />
      <link rel="up" title="Tutorials" href="../index.html" />
      <link rel="next" title="Configuring HTTP Header Proxy Authentication" href="../httpheaderproxy/index.html" />
      <link rel="prev" title="Configuring X.509 Certificate Authentication" href="../cert/index.html" />
</head>
<body class="security/tutorials/j2ee/index">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Security</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Tutorials</a> &raquo;</li>
  <li>Configuring J2EE Authentication</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../httpheaderproxy/index.html" title="Configuring HTTP Header Proxy Authentication"
       accesskey="N">next</a></li>
  <li>
    <a href="../cert/index.html" title="Configuring X.509 Certificate Authentication"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="configuring-j2ee-authentication">
<span id="sec-tutorials-j2ee"></span><h1>Configuring J2EE Authentication<a class="headerlink" href="#configuring-j2ee-authentication" title="Permalink to this headline">¶</a></h1>
<p>Servlet containers such as Tomcat and Jetty offer their own options for
authentication. Often it is desirable for an application such as GeoServer
to use that existing authentication mechanisms rather than require its own
authentication configuration.</p>
<p>J2EE authentication allows GeoServer to delegate to the servlet container for
authentication. This tutorial walks through the process of setting up J2EE
authentication.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This tutorial requires a servlet container capable of doing its own authentication.
This tutorial uses Tomcat.</p>
<p>Deploy GeoServer in tomcat before proceeding.</p>
</div>
<div class="section" id="configure-the-j2ee-authentication-filter">
<h2>Configure the J2EE authentication filter<a class="headerlink" href="#configure-the-j2ee-authentication-filter" title="Permalink to this headline">¶</a></h2>
<p>In order to delegate to the container for authentication a filter must first be
configured to recognize the container authentication.</p>
<ol class="arabic">
<li><p class="first">Login to the GeoServer web admin interface as the <tt class="docutils literal"><span class="pre">admin</span></tt> user.</p>
</li>
<li><p class="first">Click the <tt class="docutils literal"><span class="pre">Authentication</span></tt> link located under the <tt class="docutils literal"><span class="pre">Security</span></tt> section of
the navigation sidebar.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee1.jpg" src="../../../_images/j2ee1.jpg" />
</div>
</li>
<li><p class="first">Scroll down to the <tt class="docutils literal"><span class="pre">Authentication</span> <span class="pre">Filter</span></tt> panel and click the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">new</span></tt> link.</p>
</li>
<li><p class="first">Create a new filter named &#8220;j2ee&#8221; and fill out the settings form
as follows:</p>
<ul class="simple">
<li>Set the <tt class="docutils literal"><span class="pre">Role</span> <span class="pre">service</span></tt> to &#8220;default&#8221;</li>
</ul>
<div class="figure align-center">
<img alt="../../../_images/j2ee2.jpg" src="../../../_images/j2ee2.jpg" />
</div>
</li>
<li><p class="first">Save</p>
</li>
<li><p class="first">Back on the authentication page scroll down to the <tt class="docutils literal"><span class="pre">Filter</span> <span class="pre">Chains</span></tt> panel.</p>
</li>
<li><p class="first">Select &#8220;Web UI&#8221; from the <tt class="docutils literal"><span class="pre">Request</span> <span class="pre">type</span></tt> drop down.</p>
</li>
<li><p class="first">Select the <tt class="docutils literal"><span class="pre">j2ee</span></tt> filter and position it after the <tt class="docutils literal"><span class="pre">anonymous</span></tt> filter.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee3.jpg" src="../../../_images/j2ee3.jpg" />
</div>
</li>
<li><p class="first">Save.</p>
</li>
</ol>
</div>
<div class="section" id="configure-the-role-service">
<h2>Configure the role service<a class="headerlink" href="#configure-the-role-service" title="Permalink to this headline">¶</a></h2>
<p>Since it is not possible to ask a J2EE container for the roles of a principal it is
necessary to have all J2EE roles enlisted in a role service. The only J2EE API GeoServer
can use is:</p>
<div class="highlight-python"><pre>class: javax.servlet.http.HttpServletRequest
method: boolean isUserInRole(String role)</pre>
</div>
<p>The idea is to query all roles from the role service and test each role with the &#8220;isUserInRole&#8221; method.</p>
<p>This tutorial assumes a user named &#8220;admin&#8221; with password &#8220;password&#8221; and a J2EE role named &#8220;tomcat&#8221;.</p>
<ol class="arabic">
<li><p class="first">Click the <tt class="docutils literal"><span class="pre">Users,</span> <span class="pre">Groups,</span> <span class="pre">and</span> <span class="pre">Roles</span></tt> link located under the <tt class="docutils literal"><span class="pre">Security</span></tt> section of
the navigation sidebar.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee5.jpg" src="../../../_images/j2ee5.jpg" />
</div>
</li>
<li><p class="first">Click on <tt class="docutils literal"><span class="pre">default</span></tt> to work with the role service named &#8220;default&#8221;.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee6.jpeg" src="../../../_images/j2ee6.jpeg" />
</div>
</li>
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">Roles</span></tt> tab.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee7.jpeg" src="../../../_images/j2ee7.jpeg" />
</div>
</li>
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">new</span> <span class="pre">role</span></tt> link.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee8.jpeg" src="../../../_images/j2ee8.jpeg" />
</div>
<ul class="simple">
<li>Set the <tt class="docutils literal"><span class="pre">Name</span></tt> to &#8220;tomcat&#8221;</li>
</ul>
<div class="figure align-center">
<img alt="../../../_images/j2ee9.jpeg" src="../../../_images/j2ee9.jpeg" />
</div>
</li>
<li><p class="first">Save</p>
</li>
</ol>
</div>
<div class="section" id="configure-tomcat-for-authentication">
<h2>Configure Tomcat for authentication<a class="headerlink" href="#configure-tomcat-for-authentication" title="Permalink to this headline">¶</a></h2>
<p>By default Tomcat does not require authentication for web applications. In this
section Tomcat will be configured to secure GeoServer requiring a basic authentication
login.</p>
<ol class="arabic">
<li><p class="first">Shut down Tomcat.</p>
</li>
<li><p class="first">Edit the <tt class="docutils literal"><span class="pre">conf/tomcat-users.xml</span></tt> under the Tomcat root directory and add a user
named &#8220;admin&#8221;:</p>
<div class="highlight-python"><pre>&lt;user username="admin" password="password" roles="tomcat"/&gt;</pre>
</div>
</li>
<li><p class="first">Edit the GeoServer <tt class="docutils literal"><span class="pre">web.xml</span></tt> file located at <tt class="docutils literal"><span class="pre">webapps/geoserver/WEB-INF/web.xml</span></tt>
under the Tomcat root directory and add the following at the end of the file directly
before the closing <tt class="docutils literal"><span class="pre">&lt;/web-app&gt;</span></tt> element:</p>
<div class="highlight-python"><pre>&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
     &lt;http-method&gt;GET&lt;/http-method&gt;
     &lt;http-method&gt;POST&lt;/http-method&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;tomcat&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;login-config&gt;
  &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
&lt;/login-config&gt;</pre>
</div>
</li>
<li><p class="first">Save <tt class="docutils literal"><span class="pre">web.xml</span></tt> and restart Tomcat.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is necessary to add all the role names specified in the <tt class="docutils literal"><span class="pre">web.xml</span></tt> to the
configured role service. This is duplicate work but there is currently no other solution.</p>
</div>
</div>
<div class="section" id="test-j2ee-login">
<h2>Test J2EE login<a class="headerlink" href="#test-j2ee-login" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Navigate to the GeoServer web admin interface. The result should be a prompt
to authenticate.</p>
</li>
<li><p class="first">Enter in the username &#8220;admin&#8221; and password &#8220;password&#8221;</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee4.jpg" src="../../../_images/j2ee4.jpg" />
</div>
</li>
</ol>
<p>The result should be the admin user logged into the GeoServer web admin.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="../cert/index.html" title="previous chapter">Configuring X.509 Certificate Authentication</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="../httpheaderproxy/index.html" title="next chapter">Configuring HTTP Header Proxy Authentication</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Configuring J2EE Authentication</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#configure-the-j2ee-authentication-filter">Configure the J2EE authentication filter</a></li>
<li><a class="reference internal" href="#configure-the-role-service">Configure the role service</a></li>
<li><a class="reference internal" href="#configure-tomcat-for-authentication">Configure Tomcat for authentication</a></li>
<li><a class="reference internal" href="#test-j2ee-login">Test J2EE login</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="../cert/index.html" title="previous chapter">Configuring X.509 Certificate Authentication</a></li>
            <li>Next: <a href="../httpheaderproxy/index.html" title="next chapter">Configuring HTTP Header Proxy Authentication</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../../_sources/security/tutorials/j2ee/index.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
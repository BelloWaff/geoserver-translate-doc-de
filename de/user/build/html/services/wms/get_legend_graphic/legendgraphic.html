
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>GetLegendGraphic &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../../../index.html" />
      <link rel="up" title="Web Map Service" href="../index.html" />
      <link rel="next" title="Web Coverage Service" href="../../wcs/index.html" />
      <link rel="prev" title="Global variables affecting WMS" href="../global.html" />
</head>
<body class="services/wms/get_legend_graphic/legendgraphic">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Services</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Web Map Service</a> &raquo;</li>
  <li>GetLegendGraphic</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../wcs/index.html" title="Web Coverage Service"
       accesskey="N">next</a></li>
  <li>
    <a href="../global.html" title="Global variables affecting WMS"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="getlegendgraphic">
<span id="get-legend-graphic"></span><h1>GetLegendGraphic<a class="headerlink" href="#getlegendgraphic" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes whether to use the GetLegendGraphics request. The SLD Specifications 1.0.0 gives a good description about GetLegendGraphic requests:</p>
<p><cite>The GetLegendGraphic operation itself is optional for an SLD-enabled WMS. It provides a general mechanism for acquiring legend symbols, beyond the LegendURL reference of WMS Capabilities. Servers supporting the GetLegendGraphic call might code LegendURL references as GetLegendGraphic for interface consistency. Vendor-specific parameters may be added to GetLegendGraphic requests and all of the usual OGC-interface options and rules apply. No XML-POST method for GetLegendGraphic is presently defined</cite>.</p>
<p>Here is an example invocation:</p>
<div class="highlight-python"><pre>http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=topp:states</pre>
</div>
<p>which would produce four 20x20 icons that graphically represent the rules of the default style of the topp:states layer.</p>
<div class="figure align-center">
<img alt="../../../_images/samplelegend.png" src="../../../_images/samplelegend.png" />
<p class="caption"><em>Sample legend</em></p>
</div>
<p>In the following table the whole set of GetLegendGraphic parameters that can be used.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="5%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Parameter</strong></td>
<td><strong>Required</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><em>REQUEST</em></td>
<td>Required</td>
<td>Value must be &#8220;GetLegendRequest&#8221;.</td>
</tr>
<tr class="row-odd"><td><em>LAYER</em></td>
<td>Required</td>
<td>Layer for which to produce legend graphic.</td>
</tr>
<tr class="row-even"><td><em>STYLE</em></td>
<td>Optional</td>
<td>Style of layer for which to produce legend graphic. If not present, the default style is selected. The style may be any valid style available for a layer, including non-SLD internally-defined styles.</td>
</tr>
<tr class="row-odd"><td><em>FEATURETYPE</em></td>
<td>Optional</td>
<td>Feature type for which to produce the legend graphic. This is not needed if the layer has only a single feature type.</td>
</tr>
<tr class="row-even"><td><em>RULE</em></td>
<td>Optional</td>
<td>Rule of style to produce legend graphic for, if applicable. In the case that a style has multiple rules but no specific rule is selected, then the map server is obligated to produce a graphic that is representative of all of the rules of the style.</td>
</tr>
<tr class="row-odd"><td><em>SCALE</em></td>
<td>Optional</td>
<td>In the case that a RULE is not specified for a style, this parameter may assist the server in selecting a more appropriate representative graphic by eliminating internal rules that are out-of-scope. This value is a standardized scale denominator, defined in Section 10.2. Specifying the scale will also make the symbolizers using Unit Of Measure resize according to the specified scale.</td>
</tr>
<tr class="row-even"><td><em>SLD</em></td>
<td>Optional</td>
<td>This parameter specifies a reference to an external SLD document. It works in the same way as the SLD= parameter of the WMS GetMap operation.</td>
</tr>
<tr class="row-odd"><td><em>SLD_BODY</em></td>
<td>Optional</td>
<td>This parameter allows an SLD document to be included directly in an HTTP-GET request. It works in the same way as the SLD_BODY= parameter of the WMS GetMap operation.</td>
</tr>
<tr class="row-even"><td><em>FORMAT</em></td>
<td>Required</td>
<td>This gives the MIME type of the file format in which to return the legend graphic. Allowed values are the same as for the FORMAT= parameter of the WMS GetMap request.</td>
</tr>
<tr class="row-odd"><td><em>WIDTH</em></td>
<td>Optional</td>
<td>This gives a hint for the width of the returned graphic in pixels. Vector-graphics can use this value as a hint for the level of detail to include.</td>
</tr>
<tr class="row-even"><td><em>HEIGHT</em></td>
<td>Optional</td>
<td>This gives a hint for the height of the returned graphic in pixels.</td>
</tr>
<tr class="row-odd"><td><em>EXCEPTIONS</em></td>
<td>Optional</td>
<td>This gives the MIME type of the format in which to return exceptions. Allowed values are the same as for the EXCEPTIONS= parameter of the WMS GetMap request.</td>
</tr>
</tbody>
</table>
<div class="section" id="controlling-legend-appearance-with-legend-options">
<h2>Controlling legend appearance with LEGEND_OPTIONS<a class="headerlink" href="#controlling-legend-appearance-with-legend-options" title="Permalink to this headline">¶</a></h2>
<p>GeoServer allows finer control over the legend appearance via the vendor parameter <tt class="docutils literal"><span class="pre">LEGEND_OPTIONS</span></tt>.
The general format of <tt class="docutils literal"><span class="pre">LEGEND_OPTIONS</span></tt> is the same as <tt class="docutils literal"><span class="pre">FORMAT_OPTIONS</span></tt>, that is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">...&amp;</span><span class="n">LEGEND_OPTION</span><span class="o">=</span><span class="n">key1</span><span class="p">:</span><span class="n">v1</span><span class="p">;</span><span class="n">key2</span><span class="p">:</span><span class="n">v2</span><span class="p">;</span><span class="o">...</span><span class="p">;</span><span class="n">keyn</span><span class="p">:</span><span class="n">vn</span>
</pre></div>
</div>
<p>Here is a description of the various parameters that can be used in <tt class="docutils literal"><span class="pre">LEGEND_OPTIONS</span></tt>:</p>
<blockquote>
<div><ul class="simple">
<li><strong>fontName (string)</strong> the name of the font to be used when generating rule titles. The font must be available on the server</li>
<li><strong>fontStyle (string)</strong> can be set to italic or bold to control the text style. Other combination are not allowed right now but we could implement that as well.</li>
<li><strong>fontSize (integer)</strong> allows us to set the Font size for the various text elements. Notice that default size is 12.</li>
<li><strong>fontColor (hex)</strong> allows us to set the color for the text of rules and labels (see above for recommendation on how to create values). Values are expressed in <tt class="docutils literal"><span class="pre">0xRRGGBB</span></tt> format</li>
<li><strong>fontAntiAliasing (true/false)</strong> when true enables antialiasing for rule titles</li>
<li><strong>bgColor (hex)</strong> background color for the generated legend, values are expressed in <tt class="docutils literal"><span class="pre">0xRRGGBB</span></tt> format</li>
<li><strong>dpi (integer)</strong> sets the DPI for the current request, in the same way as it is supported by GetMap. Setting a DPI larger than 91 (the default) makes all fonts, symbols and line widths grow without changing the current scale, making it possible to get a high resolution version of the legend suitable for inclusion in printouts</li>
<li><strong>forceLabels</strong> &#8220;on&#8221; means labels will always be drawn, even if only one rule is available. &#8220;off&#8221; means labels will never be drawn, even if multiple rules are available. Off by default.</li>
</ul>
</div></blockquote>
<p>Here is a sample request sporting all the options:</p>
<div class="highlight-python"><pre>http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=topp:states&amp;legend_options=fontName:Times%20New%20Roman;fontAntiAliasing:true;fontColor:0x000033;fontSize:14;bgColor:0xFFFFEE;dpi:180</pre>
</div>
<div class="figure align-center">
<img alt="../../../_images/legendoptions.png" src="../../../_images/legendoptions.png" />
<p class="caption"><em>Using LEGEND_OPTIONS to control the output</em></p>
</div>
</div>
<div class="section" id="raster-legends-explained">
<h2>Raster Legends Explained<a class="headerlink" href="#raster-legends-explained" title="Permalink to this headline">¶</a></h2>
<p>This chapter aim to briefly describe the work that I have performed in order to support legends for raster data that draw information taken from the various bits of the SLD 1.0 RasterSymbolizer element. Recall, that up to now there was no way to create legends for raster data, therefore we have tried to fill the gap by providing an implementation of the getLegendGraphic request that would work with the ColorMap element of the SLD 1.0 RasterSymbolizer. Notice that some &#8220;debug&#8221; info about the style, like colormap type and band used are printed out as well.</p>
<div class="section" id="what-s-a-raster-legend">
<h3>What&#8217;s a raster legend<a class="headerlink" href="#what-s-a-raster-legend" title="Permalink to this headline">¶</a></h3>
<p>Here below I have drawn the structure of a typical legend, where some elements of interests are parameterized.</p>
<div class="figure align-center">
<img alt="../../../_images/rasterlegend1.png" src="../../../_images/rasterlegend1.png" />
<p class="caption"><em>The structure of a typical legend</em></p>
</div>
<p>Take as an instance one of the SLD files attached to this page, each row in the above table draws its essence from the  ColorMapEntry element as shown here below:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ColorMapEntry</span> <span class="na">color=</span><span class="s">&quot;#732600&quot;</span> <span class="na">quantity=</span><span class="s">&quot;9888&quot;</span> <span class="na">opacity=</span><span class="s">&quot;1.0&quot;</span> <span class="na">label=</span><span class="s">&quot;&lt;-70 mm&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The producer for the raster legend will make use of this elements in order to build the legend, with this regards, notice that:</p>
<blockquote>
<div><ul class="simple">
<li>the width of the Color element is driven by the requested width for the GetLegendGraphic request</li>
<li>the width and height of label and rules is computed accordingly to the used Font and Font size for the prepared text (<strong>no new line management for the moment</strong>)</li>
<li>the height of the Color element is driven by the requested width for the GetLegendGraphic request, but notice that for ramps we expand this a little since the goal is to turn the various Color elements into a single long strip</li>
<li>the height of each row is set to the maximum height of the single elements</li>
<li>the width of each row is set to the sum of the width of the various elements plus the various paddings</li>
<li><strong>dx,dy</strong> the spaces between elements and rows are set to the 15% of the requested width and height. Notice that <strong>dy</strong> is ignored for the colormaps of type <strong>ramp</strong> since they must create a continous color strip.</li>
<li><strong>mx,my</strong> the margins from the border of the legends are set to the 1.5% of the total size of the legend</li>
</ul>
</div></blockquote>
<p>Just to jump right to the conclusions (which is a bad practice I know, but no one is perfect ), here below I am adding an image of a sample legend with all the various options at work. The request that generated it is the following:</p>
<div class="highlight-python"><pre>http://localhost:8081/geoserver/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=100&amp;HEIGHT=20&amp;LAYER=it.geosolutions:di08031_da&amp;LEGEND_OPTIONS=forceRule:True;dx:0.2;dy:0.2;mx:0.2;my:0.2;fontStyle:bold;borderColor:0000ff;border:true;fontColor:ff0000;fontSize:18</pre>
</div>
<p>Do not worry if it seems like something written in ancient dead language, I am going to explain the various params here below. Nevertheless it is important to point out that basic info on how to create and set params can be found in this <a class="reference external" href="http://geoserver.org/display/GEOSDOC/GetLegendGraphic+Improvements">page</a>.</p>
<div class="figure align-center">
<img alt="../../../_images/rasterlegend2.png" src="../../../_images/rasterlegend2.png" />
<p class="caption"><em>Example of a raster legend</em></p>
</div>
</div>
<div class="section" id="raster-legends-types">
<h3>Raster legends&#8217; types<a class="headerlink" href="#raster-legends-types" title="Permalink to this headline">¶</a></h3>
<p>As you may know (well, actually you might not since I never wrote any real docs about the RasterSymbolizer work I did) GeoServer supports three types of ColorMaps:</p>
<blockquote>
<div><ul class="simple">
<li><strong>ramp</strong> this is what SLD 1.0 dictates, which means a linear interpolation weighted on values between the colors of the various ColorMapEntries.</li>
<li><strong>values</strong> this is an extensions that allows link quantities to colors as specified by the ColorMapEntries quantities. Values not specified are translated into transparent pixels.</li>
<li><strong>classes</strong> this is an extensions that allows pure classifications based o intervals created from the  ColorMapEntries quantities. Values not specified are translated into transparent pixels.</li>
</ul>
</div></blockquote>
<p>Here below I am going to list various examples that use the attached styles on a rainfall floating point geotiff.</p>
</div>
<div class="section" id="colormap-type-is-values">
<h3>ColorMap type is VALUES<a class="headerlink" href="#colormap-type-is-values" title="Permalink to this headline">¶</a></h3>
<p>Refer to the SLD rainfall.sld in attachment.</p>
<div class="figure align-center">
<img alt="../../../_images/rasterlegend3.png" src="../../../_images/rasterlegend3.png" />
<p class="caption"><em>Raster legend - VALUES type</em></p>
</div>
</div>
<div class="section" id="colormap-type-is-classes">
<h3>ColorMap type is CLASSES<a class="headerlink" href="#colormap-type-is-classes" title="Permalink to this headline">¶</a></h3>
<p>Refer to the SLD rainfall_classes.sld in attachment.</p>
<div class="figure align-center">
<img alt="../../../_images/rasterlegend4.png" src="../../../_images/rasterlegend4.png" />
<p class="caption"><em>Raster legend - CLASSES type</em></p>
</div>
</div>
<div class="section" id="colormap-type-is-ramp">
<h3>ColorMap type is RAMP<a class="headerlink" href="#colormap-type-is-ramp" title="Permalink to this headline">¶</a></h3>
<p>Refer to the SLD rainfall_classes.sld in attachment. Notice that the first legend show the default border behavior while the second has been force to draw a border for the breakpoint color of the the colormap entry quantity described by the rendered text. Notice that each color element has a part that show the fixed color from the colormap entry it depicts (the lowest part of it, the one that has been outlined by the boder in the second legend here below) while the upper part of the element has a gradient tha connects each element to the previous one to point out the fact that we are using linear interpolation.</p>
<div class="figure align-center">
<img alt="../../../_images/rasterlegend5.png" src="../../../_images/rasterlegend5.png" />
<p class="caption"><em>Raster legend - RAMP type</em></p>
</div>
</div>
<div class="section" id="the-various-control-parameters-and-how-to-set-them">
<h3>The various control parameters and how to set them<a class="headerlink" href="#the-various-control-parameters-and-how-to-set-them" title="Permalink to this headline">¶</a></h3>
<p>I am now going to briefly explain the various parameters tht we can use to control the layout and content of the legend (refer also to this <a class="reference external" href="http://geoserver.org/display/GEOSDOC/GetLegendGraphic+Improvements">page</a>). Here below I have put a request that puts all the various options at tow:</p>
<div class="highlight-python"><pre>http://localhost:8081/geoserver/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=100&amp;HEIGHT=20&amp;LAYER=it.geosolutions:di08031_da&amp;LEGEND_OPTIONS=forceRule:True;dx:0.2;dy:0.2;mx:0.2;my:0.2;fontStyle:bold;borderColor:0000ff;border:true;fontColor:ff0000;fontSize:18</pre>
</div>
<p>Let&#8217;s now examine all the interesting elements, one by one. Notice that I am not going to discuss the mechanics of the  GetLegendGraphic operation, for that you may want to refer to the SLD 1.0 spec, my goal is to briefly discuss the LEGEND_OPTIONS parameter.</p>
<blockquote>
<div><ul class="simple">
<li><strong>forceRule (boolean)</strong> by defaul rules for a ColorMapEntry are not drawn to keep the legend small and compact, unless there are not labels at all. You can change this behaviour by setting this parameter to true.</li>
<li><strong>dx,dy,mx,my (double)</strong> can be used to set the margin and the buffers between elements</li>
<li><strong>border (boolean)</strong> activates or deactivates the boder on the color elements in order to make the separations cleare. Notice that I decided to <strong>always</strong> have a line that would split the various color elements for the ramp type of colormap.</li>
<li><strong>borderColor (hex)</strong> allows us to set the color for the border in 0xRRGGBB format</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="../global.html" title="previous chapter">Global variables affecting WMS</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="../../wcs/index.html" title="next chapter">Web Coverage Service</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">GetLegendGraphic</a><ul>
<li><a class="reference internal" href="#controlling-legend-appearance-with-legend-options">Controlling legend appearance with LEGEND_OPTIONS</a></li>
<li><a class="reference internal" href="#raster-legends-explained">Raster Legends Explained</a><ul>
<li><a class="reference internal" href="#what-s-a-raster-legend">What&#8217;s a raster legend</a></li>
<li><a class="reference internal" href="#raster-legends-types">Raster legends&#8217; types</a></li>
<li><a class="reference internal" href="#colormap-type-is-values">ColorMap type is VALUES</a></li>
<li><a class="reference internal" href="#colormap-type-is-classes">ColorMap type is CLASSES</a></li>
<li><a class="reference internal" href="#colormap-type-is-ramp">ColorMap type is RAMP</a></li>
<li><a class="reference internal" href="#the-various-control-parameters-and-how-to-set-them">The various control parameters and how to set them</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="../global.html" title="previous chapter">Global variables affecting WMS</a></li>
            <li>Next: <a href="../../wcs/index.html" title="next chapter">Web Coverage Service</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../../_sources/services/wms/get_legend_graphic/legendgraphic.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
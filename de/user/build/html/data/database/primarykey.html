
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Controlling feature ID generation in spatial databases &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../../index.html" />
      <link rel="up" title="Working with Databases" href="index.html" />
      <link rel="next" title="Custom SQL session start/stop scripts" href="sqlsession.html" />
      <link rel="prev" title="SQL Views" href="sqlview.html" />
</head>
<body class="data/database/primarykey">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Working with Databases</a> &raquo;</li>
  <li>Controlling feature ID generation in spatial databases</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="sqlsession.html" title="Custom SQL session start/stop scripts"
       accesskey="N">next</a></li>
  <li>
    <a href="sqlview.html" title="SQL Views"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="controlling-feature-id-generation-in-spatial-databases">
<span id="primarykey"></span><h1>Controlling feature ID generation in spatial databases<a class="headerlink" href="#controlling-feature-id-generation-in-spatial-databases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>All spatial database data stores (PostGIS, Oracle, MySQL and so on) normally derive the feature ID the table primary key and assume certain conventions on how to locate the next value for the key in case a new feature needs to be generated (WFS insert operation).</p>
<p>Common conventions rely on finding auto-increment columns (PostGIS) or finding a sequence that is named after a specific convention such as <tt class="docutils literal"><span class="pre">&lt;table&gt;_&lt;column&gt;_SEQUENCE</span></tt> (Oracle case).</p>
<p>In case none of the above is found normally the store will fall back on generating random feature IDs at each new request, making the table unsuitable for feauture ID based searches and transactions.</p>
</div>
<div class="section" id="metadata-table-description">
<h2>Metadata table description<a class="headerlink" href="#metadata-table-description" title="Permalink to this headline">¶</a></h2>
<p>These defaults can be overridden manually by creating a <cite>primary key metadata table</cite> that specifies which columns to use and what strategy to use to generate new primary key values. The table can be created with this SQL statement (this one is valid for PostGIS, adapt it to your specific database, you may remove the check at the end if you want to):</p>
<div class="highlight-python"><pre>CREATE TABLE gt_pk_metadata_table (
  table_schema VARCHAR(32) NOT NULL,
  table_name VARCHAR(32) NOT NULL,
  pk_column VARCHAR(32) NOT NULL,
  pk_column_idx INTEGER,
  pk_policy VARCHAR(32),
  pk_sequence VARCHAR(64),
  unique (table_schema, table_name, pk_column),
  check (pk_policy in ('sequence', 'assigned', 'autoincrement'))
)</pre>
</div>
<p>The table can be given a different name, in that case the name (eventually schema qualified) of the table must be specified in the <cite>primary key metadata table</cite> configuration parameter of the store.</p>
<p>The following table describes the meaning of each column in the metadata table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Column</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><em class="guilabel">table_schema</em></td>
<td>Name of the database schema in which the table is located.</td>
</tr>
<tr class="row-odd"><td><em class="guilabel">table_name</em></td>
<td>Name of the table to be published</td>
</tr>
<tr class="row-even"><td><em class="guilabel">pk_column</em></td>
<td>Name of a column used to form the feauture IDs</td>
</tr>
<tr class="row-odd"><td><em class="guilabel">pk_column_idx</em></td>
<td>Index of the column in a multi-column key. In case multi column keys are needed multiple records with the same table schema and table name will be used.</td>
</tr>
<tr class="row-even"><td><em class="guilabel">pk_policy</em></td>
<td>The new value generation policy, used in case a new feature needs to be added in the table (following a WFS-T insert operation).</td>
</tr>
<tr class="row-odd"><td><em class="guilabel">pk_sequence</em></td>
<td>The name of the database sequence to be used when generating a new value for the pk_column.</td>
</tr>
</tbody>
</table>
<p>The possible values are:</p>
<blockquote>
<div><ul class="simple">
<li><cite>assigned</cite>. The value of the attribute in the newly inserted feature will be used (this assumes the &#8220;expose primary keys&#8221; flag has been enabled)</li>
<li><cite>sequence</cite>. The value of the attribute will be generated from the next value of a sequence indicated in the &#8220;pk_sequence&#8221; column.</li>
<li><cite>autogenerated</cite>. The column is an auto-increment one, the next value in the auto-increment will be used.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="using-the-metadata-table-with-views">
<h2>Using the metadata table with views<a class="headerlink" href="#using-the-metadata-table-with-views" title="Permalink to this headline">¶</a></h2>
<p>GeoServer can publish spatial views without issues, but normally results in two side effects:</p>
<blockquote>
<div><ul class="simple">
<li>the view is treated as read only</li>
<li>the feauture IDs are randomly generated</li>
</ul>
</div></blockquote>
<p>The metadata table can also refer to views, just use the view name in the <tt class="docutils literal"><span class="pre">table_name</span></tt> column: this will result in stable ids, and in databases supporting updatable views, it will also make the code treat the view as writable (thus, enabling usage of WFS-T on it).</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="sqlview.html" title="previous chapter">SQL Views</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="sqlsession.html" title="next chapter">Custom SQL session start/stop scripts</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Controlling feature ID generation in spatial databases</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#metadata-table-description">Metadata table description</a></li>
<li><a class="reference internal" href="#using-the-metadata-table-with-views">Using the metadata table with views</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="sqlview.html" title="previous chapter">SQL Views</a></li>
            <li>Next: <a href="sqlsession.html" title="next chapter">Custom SQL session start/stop scripts</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../_sources/data/database/primarykey.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
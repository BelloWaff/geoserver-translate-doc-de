
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Feature Chaining &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../../index.html" />
      <link rel="up" title="Working with Application Schemas" href="index.html" />
      <link rel="next" title="Polymorphism" href="polymorphism.html" />
      <link rel="prev" title="Data Stores" href="data-stores.html" />
</head>
<body class="data/app-schema/feature-chaining">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Working with Application Schemas</a> &raquo;</li>
  <li>Feature Chaining</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="polymorphism.html" title="Polymorphism"
       accesskey="N">next</a></li>
  <li>
    <a href="data-stores.html" title="Data Stores"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="feature-chaining">
<span id="app-schema-feature-chaining"></span><h1>Feature Chaining<a class="headerlink" href="#feature-chaining" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scope">
<h2>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h2>
<p>This page describes the use of &#8220;Feature Chaining&#8221; to compose complex features from simpler components, and in particular to address some requirements that have proven significant in practice.</p>
<blockquote>
<div><ul class="simple">
<li>Handling multiple cases of multi-valued properties within a single Feature Type</li>
<li>Handing nesting of multi-valued properties within other multi-valued properties</li>
<li>Linking related (through association) Feature Types, and in particular allowing re-use of the related features types (for example the O&amp;M pattern has relatedObservation from a samplingFeature, but Observation may be useful in its own right)</li>
<li>Encoding the same referenced property object as links when it appears in multiple containing features</li>
<li>Eliminating the need for large denormalized data store views of top level features and their related features. Denormalized views would still be needed for special cases, such as many-to-many relationships, but won&#8217;t be as large.</li>
</ul>
</div></blockquote>
<p>The current state of the User guide refers to setting up Geotools application schema configurations, and will be updated to reflect a Geoserver 2.0 configuration example shortly.
For non-application schema configurations, please refer to <a class="reference internal" href="data-access-integration.html#app-schema-data-access-integration"><em>Data Access Integration</em></a>.</p>
<div class="section" id="versions-supported">
<h3>Versions supported<a class="headerlink" href="#versions-supported" title="Permalink to this headline">¶</a></h3>
<p>Feature chaining is implemented within the app-schemas module in GeoTools trunk (from 2.6.x on). Work on supporting this in Geoserver trunk is currently underway.  It is not supported in GeoServer 1.6 community-schemas.</p>
</div>
</div>
<div class="section" id="mapping-steps">
<h2>Mapping steps<a class="headerlink" href="#mapping-steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-mapping-file-for-every-complex-type">
<h3>Create a mapping file for every complex type<a class="headerlink" href="#create-a-mapping-file-for-every-complex-type" title="Permalink to this headline">¶</a></h3>
<p>We need one mapping file per complex type that is going to be nested, including non features, e.g. gsml:CompositionPart.</p>
<p>Non-feature types that cannot be individually accessed (eg. CompositionPart as a Data Type) can still be mapped separately for its reusability. For this case, the containing feature type has to include these types in its mapping file. The include tag should contain the nested mapping file path relative to the location of the containing type mapping file.
In <a class="reference download internal" href="../../_downloads/GeologicUnit_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">GeologicUnit_MappingFile.xml</span></tt></a>:</p>
<div class="highlight-python"><pre>&lt;includedTypes&gt;
    &lt;Include&gt;CGITermValue_MappingFile.xml&lt;/Include&gt;
    &lt;Include&gt;CompositionPart_MappingFile.xml&lt;/Include&gt;
&lt;/includedTypes&gt;</pre>
</div>
<p>Feature types that can be individually accessed don&#8217;t need to be explicitly included in the mapping file, as they would be configured for GeoServer to find.
Such types would have their mapping file associated with a corresponding datastore.xml file, which means that it can be found from the data store registry.
In other words, if the type is associated with a datastore.xml file, it doesn&#8217;t need to be explicitly included if referred from another mapping file.</p>
<p><strong>Example</strong>:</p>
<p>For this output: <a class="reference download internal" href="../../_downloads/MappedFeature_Output.xml"><tt class="xref download docutils literal"><span class="pre">MappedFeature_Output.xml</span></tt></a>, here are the mapping files:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference download internal" href="../../_downloads/MappedFeature_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">MappedFeature_MappingFile.xml</span></tt></a></li>
<li><a class="reference download internal" href="../../_downloads/GeologicUnit_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">GeologicUnit_MappingFile.xml</span></tt></a></li>
<li><a class="reference download internal" href="../../_downloads/CompositionPart_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">CompositionPart_MappingFile.xml</span></tt></a></li>
<li><a class="reference download internal" href="../../_downloads/GeologicEvent_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">GeologicEvent_MappingFile.xml</span></tt></a></li>
<li><a class="reference download internal" href="../../_downloads/CGITermValue_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">CGITermValue_MappingFile.xml</span></tt></a></li>
</ul>
</div></blockquote>
<p><em>GeologicUnit type</em></p>
<p>You can see within GeologicUnit features, both gml:composition (CompositionPart type) and gsml:geologicHistory (GeologicEvent type) are multi-valued properties.
It shows how multiple cases of multi-valued properties can be configured within a single Feature Type.
This also proves that you can &#8220;chain&#8221; non-feature type, as CompositionPart is a Data Type.</p>
<p><em>GeologicEvent type</em></p>
<p>Both gsml:eventEnvironment (CGI_TermValue type) and gsml:eventProcess (also of CGI_TermValue type) are multi-valued properties.
This also shows that &#8220;chaining&#8221; can be done on many levels, as GeologicEvent is nested inside GeologicUnit.
Note that gsml:eventAge properties are configured as inline attributes, as there can only be one event age per geologic event, thus eliminating the need for feature chaining.</p>
</div>
<div class="section" id="configure-nesting-on-the-nested-feature-type">
<h3>Configure nesting on the nested feature type<a class="headerlink" href="#configure-nesting-on-the-nested-feature-type" title="Permalink to this headline">¶</a></h3>
<p>In the nested feature type, make sure we have a field that can be referenced by the parent feature.
If there isn&#8217;t any existing field that can be referred to, the system field <em>FEATURE_LINK</em> can be mapped to hold the foreign key value. This is a multi-valued field, so more than one instances can be mapped in the same feature type, for features that can be nested by different parent types. Since this field doesn&#8217;t exist in the schema, it wouldn&#8217;t appear in the output document.</p>
<p>In the source expression tag:</p>
<blockquote>
<div><ul class="simple">
<li>OCQL: the value of this should correspond to the OCQL part of the parent feature</li>
</ul>
</div></blockquote>
<p><strong>Example One</strong>: Using <em>FEATURE_LINK</em> in CGI TermValue type, which is referred by GeologicEvent as gsml:eventProcess and gsml:eventEnvironment.</p>
<p>In GeologicEvent (the container feature) mapping:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
      &lt;targetAttribute&gt;gsml:eventEnvironment&lt;/targetAttribute&gt;
      &lt;sourceExpression&gt;
              &lt;OCQL&gt;getID()&lt;/OCQL&gt;
              &lt;linkElement&gt;gsml:CGI_TermValue&lt;/linkElement&gt;
              &lt;linkField&gt;FEATURE_LINK[1]&lt;/linkField&gt;
      &lt;/sourceExpression&gt;
      &lt;isMultiple&gt;true&lt;/isMultiple&gt;
&lt;/AttributeMapping&gt;
&lt;AttributeMapping&gt;
      &lt;targetAttribute&gt;gsml:eventProcess&lt;/targetAttribute&gt;
      &lt;sourceExpression&gt;
              &lt;OCQL&gt;getID()&lt;/OCQL&gt;
              &lt;linkElement&gt;gsml:CGI_TermValue&lt;/linkElement&gt;
              &lt;linkField&gt;FEATURE_LINK[2]&lt;/linkField&gt;
      &lt;/sourceExpression&gt;
      &lt;isMultiple&gt;true&lt;/isMultiple&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
<p>In CGI_TermValue (the nested feature) mapping:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
  &lt;!-- FEATURE_LINK[1] is referred by geologic event as environment --&gt;
  &lt;targetAttribute&gt;FEATURE_LINK[1]&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
      &lt;OCQL&gt;ENVIRONMENT_OWNER&lt;/OCQL&gt;
  &lt;/sourceExpression&gt;
&lt;/AttributeMapping&gt;
&lt;AttributeMapping&gt;
  &lt;!-- FEATURE_LINK[2] is referred by geologic event as process --&gt;
  &lt;targetAttribute&gt;FEATURE_LINK[2]&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;&lt;
      &lt;OCQL&gt;PROCESS_OWNER&lt;/OCQL&gt;
  &lt;/sourceExpression&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
<p>The ENVIRONMENT_OWNER column in CGI_TermValue view corresponds to the ID column in GeologicEvent view.</p>
<p><strong>Geologic Event property file:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="45%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>id</strong></td>
<td><strong>GEOLOGIC_UNIT_ID:String</strong></td>
<td><strong>ghminage:String</strong></td>
<td><strong>ghmaxage:String</strong></td>
<td><strong>ghage_cdspace:String</strong></td>
</tr>
<tr class="row-even"><td>ge.26931120</td>
<td>gu.25699</td>
<td>Oligocene</td>
<td>Paleocene</td>
<td><a class="reference external" href="urn:cgi:classifierScheme:ICS:StratChart:2008">urn:cgi:classifierScheme:ICS:StratChart:2008</a></td>
</tr>
<tr class="row-odd"><td>ge.26930473</td>
<td>gu.25678</td>
<td>Holocene</td>
<td>Pleistocene</td>
<td><a class="reference external" href="urn:cgi:classifierScheme:ICS:StratChart:2008">urn:cgi:classifierScheme:ICS:StratChart:2008</a></td>
</tr>
<tr class="row-even"><td>ge.26930960</td>
<td>gu.25678</td>
<td>Pliocene</td>
<td>Miocene</td>
<td><a class="reference external" href="urn:cgi:classifierScheme:ICS:StratChart:2008">urn:cgi:classifierScheme:ICS:StratChart:2008</a></td>
</tr>
<tr class="row-odd"><td>ge.26932959</td>
<td>gu.25678</td>
<td>LowerOrdovician</td>
<td>LowerOrdovician</td>
<td><a class="reference external" href="urn:cgi:classifierScheme:ICS:StratChart:2008">urn:cgi:classifierScheme:ICS:StratChart:2008</a></td>
</tr>
</tbody>
</table>
<p><strong>CGI Term Value property file:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="30%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>id</strong></td>
<td><strong>VALUE:String</strong></td>
<td><strong>PROCESS_OWNER:String</strong></td>
<td><strong>ENVIRONMENT_OWNER:String</strong></td>
</tr>
<tr class="row-even"><td>3</td>
<td>fluvial</td>
<td>NULL</td>
<td>ge.26931120</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>swamp/marsh/bog</td>
<td>NULL</td>
<td>ge.26930473</td>
</tr>
<tr class="row-even"><td>5</td>
<td>marine</td>
<td>NULL</td>
<td>ge.26930960</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>submarine fan</td>
<td>NULL</td>
<td>ge.26932959</td>
</tr>
<tr class="row-even"><td>7</td>
<td>hemipelagic</td>
<td>NULL</td>
<td>ge.26932959</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>detrital deposition still water</td>
<td>ge.26930473</td>
<td>NULL</td>
</tr>
<tr class="row-even"><td>9</td>
<td>water [process]</td>
<td>ge.26932959</td>
<td>NULL</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>channelled stream flow</td>
<td>ge.26931120</td>
<td>NULL</td>
</tr>
<tr class="row-even"><td>11</td>
<td>turbidity current</td>
<td>ge.26932959</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<p>The system field <em>FEATURE_LINK</em> doesn&#8217;t get encoded in the output:</p>
<div class="highlight-python"><pre>&lt;gsml:GeologicEvent&gt;
  &lt;gml:name codeSpace="urn:cgi:classifierScheme:GSV:GeologicalUnitId"&gt;gu.25699&lt;/gml:name&gt;
  &lt;gsml:eventAge&gt;
    &lt;gsml:CGI_TermRange&gt;
       &lt;gsml:lower&gt;
          &lt;gsml:CGI_TermValue&gt;
            &lt;gsml:value codeSpace="urn:cgi:classifierScheme:ICS:StratChart:2008"&gt;Oligocene&lt;/gsml:value&gt;
          &lt;/gsml:CGI_TermValue&gt;
       &lt;/gsml:lower&gt;
       &lt;gsml:upper&gt;
          &lt;gsml:CGI_TermValue&gt;
            &lt;gsml:value codeSpace="urn:cgi:classifierScheme:ICS:StratChart:2008"&gt;Paleocene&lt;/gsml:value&gt;
          &lt;/gsml:CGI_TermValue&gt;
       &lt;/gsml:upper&gt;
    &lt;/gsml:CGI_TermRange&gt;
  &lt;/gsml:eventAge&gt;
  &lt;gsml:eventEnvironment&gt;
    &lt;gsml:CGI_TermValue&gt;
       &lt;gsml:value&gt;fluvial&lt;/gsml:value&gt;
    &lt;/gsml:CGI_TermValue&gt;
  &lt;/gsml:eventEnvironment&gt;
  &lt;gsml:eventProcess&gt;
    &lt;gsml:CGI_TermValue&gt;
       &lt;gsml:value&gt;channelled stream flow&lt;/gsml:value&gt;
    &lt;/gsml:CGI_TermValue&gt;
  &lt;/gsml:eventProcess&gt;</pre>
</div>
<p><strong>Example Two</strong>:
Using existing field (gml:name) to hold the foreign key, see <a class="reference download internal" href="../../_downloads/MappedFeature_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">MappedFeature_MappingFile.xml</span></tt></a>:</p>
<p>gsml:specification links to gml:name in GeologicUnit:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gsml:specification&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
    &lt;OCQL&gt;GEOLOGIC_UNIT_ID&lt;/OCQL&gt;
    &lt;linkElement&gt;gsml:GeologicUnit&lt;/linkElement&gt;
    &lt;linkField&gt;gml:name[3]&lt;/linkField&gt;
  &lt;/sourceExpression&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
<p>In <a class="reference download internal" href="../../_downloads/GeologicUnit_MappingFile.xml"><tt class="xref download docutils literal"><span class="pre">GeologicUnit_MappingFile.xml</span></tt></a>:</p>
<p>GeologicUnit has 3 gml:name properties in the mapping file, so each has a code space to clarify them:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gml:name[1]&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
    &lt;OCQL&gt;ABBREVIATION&lt;/OCQL&gt;
  &lt;/sourceExpression&gt;
  &lt;ClientProperty&gt;
    &lt;name&gt;codeSpace&lt;/name&gt;
    &lt;value&gt;'urn:cgi:classifierScheme:GSV:GeologicalUnitCode'&lt;/value&gt;
  &lt;/ClientProperty&gt;
&lt;/AttributeMapping&gt;
&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gml:name[2]&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
    &lt;OCQL&gt;NAME&lt;/OCQL&gt;
  &lt;/sourceExpression&gt;
  &lt;ClientProperty&gt;
    &lt;name&gt;codeSpace&lt;/name&gt;
    &lt;value&gt;'urn:cgi:classifierScheme:GSV:GeologicalUnitName'&lt;/value&gt;
  &lt;/ClientProperty&gt;
&lt;/AttributeMapping&gt;
&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gml:name[3]&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
    &lt;OCQL&gt;strTrim(getId())&lt;/OCQL&gt;
  &lt;/sourceExpression&gt;
  &lt;ClientProperty&gt;
    &lt;name&gt;codeSpace&lt;/name&gt;
    &lt;value&gt;'urn:cgi:classifierScheme:GSV:MappedFeatureReference'&lt;/value&gt;
  &lt;/ClientProperty&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
<p>The output with multiple gml:name properties and their code spaces:</p>
<div class="highlight-python"><pre>&lt;gsml:specification&gt;
  &lt;gsml:GeologicUnit gml:id="gu.25678"&gt;
      &lt;gml:description&gt;Olivine basalt, tuff, microgabbro, minor sedimentary rocks&lt;/gml:description&gt;
      &lt;gml:name codeSpace="urn:cgi:classifierScheme:GSV:GeologicalUnitCode"&gt;-Py&lt;/gml:name&gt;
      &lt;gml:name codeSpace="urn:cgi:classifierScheme:GSV:GeologicalUnitName"&gt;Yaugher Volcanic Group&lt;/gml:name&gt;
      &lt;gml:name codeSpace="urn:cgi:classifierScheme:GSV:MappedFeatureReference"&gt;gu.25678&lt;/gml:name&gt;</pre>
</div>
<p>If this is the &#8220;one&#8221; side of a one-to-many or many-to-one database relationship, we can use the feature id as the source expression field, as you can see in above examples.
See <a class="reference download internal" href="../../_downloads/one_to_many_relationship.JPG"><tt class="xref download docutils literal"><span class="pre">one_to_many_relationship.JPG</span></tt></a> as an illustration.</p>
<p>If we have a many-to-many relationship, we have to use one denormalized view for either side of the nesting. This means we can either use the feature id as the referenced field, or assign a column to serve this purpose. See <a class="reference download internal" href="../../_downloads/many_to_many_relationship.JPG"><tt class="xref download docutils literal"><span class="pre">many_to_many_relationship.JPG</span></tt></a> as an illustration.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>For many-to-many relationships, we can&#8217;t use the same denormalized view for both sides of the nesting.</li>
</ul>
</div>
<p>Test this configuration by running a getFeature request for the nested feature type on its own.</p>
</div>
<div class="section" id="configure-nesting-on-the-containing-feature-type">
<h3>Configure nesting on the &#8220;containing&#8221; feature type<a class="headerlink" href="#configure-nesting-on-the-containing-feature-type" title="Permalink to this headline">¶</a></h3>
<p>When nesting another complex type, you need to specify in your source expression:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>OCQL</strong>: OGC&#8217;s Common Query Language expression of the data store column</p>
</li>
<li><dl class="first docutils">
<dt><strong>linkElement</strong>:</dt>
<dd><ul class="first last simple">
<li>the nested element name, which is normally the targetElement or mappingName of the corresponding type.</li>
<li>on some cases, it has to be an OCQL function (see <a class="reference internal" href="polymorphism.html#app-schema-polymorphism"><em>Polymorphism</em></a>)</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><strong>linkField</strong>: the indexed XPath attribute on the nested element that OCQL corresponds to</p>
</li>
</ul>
</div></blockquote>
<p><strong>Example:</strong> Nesting composition part in geologic unit feature.</p>
<p>In Geologic Unit mapping file:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
    &lt;targetAttribute&gt;gsml:composition&lt;/targetAttribute&gt;
    &lt;sourceExpression&gt;
            &lt;OCQL&gt;getID()&lt;/OCQL&gt;
            &lt;linkElement&gt;gsml:CompositionPart&lt;/linkElement&gt;
            &lt;linkField&gt;FEATURE_LINK&lt;/linkField&gt;
    &lt;/sourceExpression&gt;
    &lt;isMultiple&gt;true&lt;/isMultiple&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
<ul class="simple">
<li><em>OCQL</em>: getID() returns the geologic unit id</li>
<li><em>linkElement</em>: links to gsml:CompositionPart type</li>
<li><em>linkField</em>: FEATURE_LINK, the linking field mapped in gsml:CompositionPart type that also stores the geologic unit id. If there are more than one of these attributes in the nested feature type, make sure the index is included, e.g. FEATURE_LINK[2].</li>
</ul>
<p><strong>Geologic Unit property file:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="5%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>id</strong></td>
<td><strong>ABBREVIATAION:String</strong></td>
<td><strong>NAME:String</strong></td>
<td><strong>TEXTDESCRIPTION:String</strong></td>
</tr>
<tr class="row-even"><td>gu.25699</td>
<td>-Py</td>
<td>Yaugher Volcanic Group</td>
<td>Olivine basalt, tuff, microgabbro, minor sedimentary rocks</td>
</tr>
<tr class="row-odd"><td>gu.25678</td>
<td>-Py</td>
<td>Yaugher Volcanic Group</td>
<td>Olivine basalt, tuff, microgabbro, minor sedimentary rocks</td>
</tr>
</tbody>
</table>
<p><strong>Composition Part property file:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>id</strong></td>
<td><strong>COMPONENT_ROLE:String</strong></td>
<td><strong>PROPORTION:String</strong></td>
<td><strong>GEOLOGIC_UNIT_ID:String</strong></td>
</tr>
<tr class="row-even"><td>cp.167775491936278812</td>
<td>interbedded component</td>
<td>significant</td>
<td>gu.25699</td>
</tr>
<tr class="row-odd"><td>cp.167775491936278856</td>
<td>interbedded component</td>
<td>minor</td>
<td>gu.25678</td>
</tr>
<tr class="row-even"><td>cp.167775491936278844</td>
<td>sole component</td>
<td>major</td>
<td>gu.25678</td>
</tr>
</tbody>
</table>
<p>Run the getFeature request to test this configuration. Check that the nested features returned in Step 2 are appropriately lined inside the containing features.
If they are not there, or exceptions are thrown, scroll down and read the &#8220;Trouble Shooting&#8221; section.</p>
</div>
</div>
<div class="section" id="multiple-mappings-of-the-same-type">
<h2>Multiple mappings of the same type<a class="headerlink" href="#multiple-mappings-of-the-same-type" title="Permalink to this headline">¶</a></h2>
<p>At times, you may find the need to have different FeatureTypeMapping instances for the same type.
You may have two different attributes of the same type that need to be nested.
For example, in gsml:GeologicUnit, you have gsml:exposureColor and gsml:outcropCharacter that are both of gsml:CGI_TermValue type.</p>
<p>This is when the optional mappingName tag mentioned in <a class="reference internal" href="mapping-file.html#app-schema-mapping-file"><em>Mapping File</em></a> comes in.
Instead of passing in the nested feature type&#8217;s targetElement in the containing type&#8217;s linkElement, specify the corresponding mappingName.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The mappingName is namespace aware and case sensitive.</li>
<li>When the referred mappingName contains special characters such as &#8216;-&#8216;, it must be enclosed with single quotes in the linkElement. E.g. &lt;linkElement&gt;&#8217;observation-method&#8217;&lt;/linkElement&gt;.</li>
<li>Each mappingName must be unique against other mappingName and targetElement tags across the application.</li>
<li>The mappingName is only to be used to identify the chained type from the nesting type. It is not a solution for multiple FeatureTypeMapping instances where &gt; 1 of them can be queried as top level features.</li>
<li>When queried as a top level feature, the normal targetElement is to be used. Filters involving the nested type should still use the targetElement in the PropertyName part of the query.</li>
<li>You can&#8217;t have more than 1 FeatureTypeMapping of the same type in the same mapping file if one of them is a top level feature. This is because featuretype.xml would look for the targetElement and wouldn&#8217;t know which one to get.</li>
</ul>
</div>
<p>The solution for the last point above is to break them up into separate files and locations with only 1 featuretype.xml in the intended top level feature location.
E.g.</p>
<blockquote>
<div><ul class="simple">
<li>You can have 2 FeatureTypeMapping instances in the same file for gsml:CGI_TermValue type since it&#8217;s not a feature type.</li>
<li>You can have 2 FeatureTypeMapping instances for gsml:MappedFeature, but they have to be broken up into separate files. The one that can be queried as top level feature type would have featuretype.xml in its location.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="nesting-simple-properties">
<h2>Nesting simple properties<a class="headerlink" href="#nesting-simple-properties" title="Permalink to this headline">¶</a></h2>
<p>You don&#8217;t need to chain multi-valued simple properties and map them separately.
The original configuration would still work.</p>
</div>
<div class="section" id="filtering-nested-attributes-on-chained-features">
<span id="app-schema-filtering-nested"></span><h2>Filtering nested attributes on chained features<a class="headerlink" href="#filtering-nested-attributes-on-chained-features" title="Permalink to this headline">¶</a></h2>
<p>Filters would work as usual. You can supply the full XPath of the attribute, and the code would handle this.
E.g. You can run the following filter on gsml:MappedFeatureUseCase2A:</p>
<div class="highlight-python"><pre>&lt;ogc:Filter&gt;
      &lt;ogc:PropertyIsEqualTo&gt;
          &lt;ogc:Function name="contains_text"&gt;
              &lt;ogc:PropertyName&gt;gsml:specification/gsml:GeologicUnit/gml:description&lt;/ogc:PropertyName&gt;
              &lt;ogc:Literal&gt;Olivine basalt, tuff, microgabbro, minor sedimentary rocks&lt;/ogc:Literal&gt;
          &lt;/ogc:Function&gt;
          &lt;ogc:Literal&gt;1&lt;/ogc:Literal&gt;
      &lt;/ogc:PropertyIsEqualTo&gt;
&lt;/ogc:Filter&gt;</pre>
</div>
</div>
<div class="section" id="multi-valued-properties-by-reference-xlink-href">
<span id="app-schema-feature-chaining-by-reference"></span><h2>Multi-valued properties by reference (<em>xlink:href</em>)<a class="headerlink" href="#multi-valued-properties-by-reference-xlink-href" title="Permalink to this headline">¶</a></h2>
<p>You may want to use feature chaining to set multi-valued properties by reference.
This is particularly handy to avoid endless loop in circular relationships.
For example, you may have a circular relationship between gsml:MappedFeature and gsml:GeologicUnit.
E.g.</p>
<blockquote>
<div><ul class="simple">
<li>gsml:MappedFeature has gsml:GeologicUnit as gsml:specification</li>
<li>gsml:GeologicUnit has gsml:MappedFeature as gsml:occurrence</li>
</ul>
</div></blockquote>
<p>Obviously you can only encode one side of the relationship, or you&#8217;ll end up with an endless loop.
You would need to pick one side to &#8220;chain&#8221; and use xlink:href for the other side of the relationship.</p>
<p>For this example, we are nesting gsml:GeologicUnit in gsml:MappedFeature as gsml:specification.</p>
<blockquote>
<div><ul>
<li><p class="first">Set up nesting on the container feature type mapping as usual:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gsml:specification&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
      &lt;OCQL&gt;GEOLOGIC_UNIT_ID&lt;/OCQL&gt;
        &lt;linkElement&gt;gsml:GeologicUnit&lt;/linkElement&gt;
        &lt;linkField&gt;gml:name[2]&lt;/linkField&gt;
  &lt;/sourceExpression&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
</li>
<li><p class="first">Set up xlink:href as client property on the other mapping file:</p>
<div class="highlight-python"><pre>&lt;AttributeMapping&gt;
  &lt;targetAttribute&gt;gsml:occurrence&lt;/targetAttribute&gt;
  &lt;sourceExpression&gt;
        &lt;OCQL&gt;strTrim(getId())&lt;/OCQL&gt;
        &lt;linkElement&gt;gsml:MappedFeature&lt;/linkElement&gt;
        &lt;linkField&gt;gsml:specification&lt;/linkField&gt;
  &lt;/sourceExpression&gt;
  &lt;isMultiple&gt;true&lt;/isMultiple&gt;
  &lt;ClientProperty&gt;
         &lt;name&gt;xlink:href&lt;/name&gt;
         &lt;value&gt;strConcat('urn:cgi:feature:MappedFeature:', getId())&lt;/value&gt;
  &lt;/ClientProperty&gt;
&lt;/AttributeMapping&gt;</pre>
</div>
</li>
</ul>
</div></blockquote>
<p>As we are getting the client property value from a nested feature, we have to set it as if we are chaining the feature; but we also add the client property containing <em>xlink:href</em> in the attribute mapping. The code will detect the <em>xlink:href</em> setting, and will not proceed to build the nested feature&#8217;s attributes, and we will end up with empty attributes with <em>xlink:href</em> client properties.</p>
<p>This would be the encoded result for gsml:GeologicUnit:</p>
<div class="highlight-python"><pre>&lt;gsml:GeologicUnit gml:id="gu.25678"&gt;
         &lt;gsml:occurrence xlink:href="urn:cgi:feature:MappedFeature:mf2"/&gt;
         &lt;gsml:occurrence xlink:href="urn:cgi:feature:MappedFeature:mf3"/&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>In the example above, we use <em>strConcat(&#8216;urn:cgi:feature:MappedFeature:&#8217;, getId())</em> as Client Property value. The function <em>getId()</em> would return the id value from the nested feature table (gsml:MappedFeature). You can use other column names from the nested feature data store.</li>
<li>Lastly, don&#8217;t forget to add <em>XLink</em> in your mapping file namespaces section, or you could end up with a StackOverflowException as the <em>xlink:href</em> client property won&#8217;t be recognized and the mappings would chain endlessly.</li>
</ul>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="data-stores.html" title="previous chapter">Data Stores</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="polymorphism.html" title="next chapter">Polymorphism</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Feature Chaining</a><ul>
<li><a class="reference internal" href="#scope">Scope</a><ul>
<li><a class="reference internal" href="#versions-supported">Versions supported</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapping-steps">Mapping steps</a><ul>
<li><a class="reference internal" href="#create-a-mapping-file-for-every-complex-type">Create a mapping file for every complex type</a></li>
<li><a class="reference internal" href="#configure-nesting-on-the-nested-feature-type">Configure nesting on the nested feature type</a></li>
<li><a class="reference internal" href="#configure-nesting-on-the-containing-feature-type">Configure nesting on the &#8220;containing&#8221; feature type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-mappings-of-the-same-type">Multiple mappings of the same type</a></li>
<li><a class="reference internal" href="#nesting-simple-properties">Nesting simple properties</a></li>
<li><a class="reference internal" href="#filtering-nested-attributes-on-chained-features">Filtering nested attributes on chained features</a></li>
<li><a class="reference internal" href="#multi-valued-properties-by-reference-xlink-href">Multi-valued properties by reference (<em>xlink:href</em>)</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="data-stores.html" title="previous chapter">Data Stores</a></li>
            <li>Next: <a href="polymorphism.html" title="next chapter">Polymorphism</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../_sources/data/app-schema/feature-chaining.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
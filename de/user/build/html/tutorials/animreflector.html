
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>WMS Animator &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/searchtools.js"></script>
  <script type="text/javascript" src="../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../index.html" />
      <link rel="up" title="Tutorials" href="index.html" />
      <link rel="next" title="CQL and ECQL" href="cql/cql_tutorial.html" />
      <link rel="prev" title="WMS Reflector" href="wmsreflector.html" />
</head>
<body class="tutorials/animreflector">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Tutorials</a> &raquo;</li>
  <li>WMS Animator</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="cql/cql_tutorial.html" title="CQL and ECQL"
       accesskey="N">next</a></li>
  <li>
    <a href="wmsreflector.html" title="WMS Reflector"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="wms-animator">
<span id="tutorials-animreflector"></span><h1>WMS Animator<a class="headerlink" href="#wms-animator" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Current WMS can only generate static maps. There is however a number of use cases in which generating an animation is interesting. One obvious case is time based animation, but elevation based animation is just as interesting, and there are cases in which the various frames have to be generated by changing the parameters of sql views, sld substitution parameters, or plain coordinates of the generated map (to get a moving one).</p>
<p>The animator works pretty much like the WMS reflector, but is installed on the wms/animate path: given an incomplete WMS request it fills it putting and using extra parameters to turn it into a repeated template:</p>
<ul class="simple">
<li><strong>aparam</strong>: the name of the parameter that will be used to change the request at each step. Could be anything from layers, cql_filter, bbox, style and so on. In case it is a nested parameter, like for the format_options, env and view_param case, it will take the form of container:name, for example, view_params:year</li>
<li><strong>avalues</strong>: a comma separated list of the values the parameter will take.</li>
</ul>
<p>One example of animated request based on a changing bbox will be:</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?layers=topp:states&amp;aparam=bbox&amp;avalues=-90\,40\,-60\,70,-80\,40\,-60\70,-70\,40\,-50\70</pre>
</div>
<p>which would generate an animation of the layer with the camera scrolling towards east.</p>
<p>An example of an animation changing colors based on SLD enviroment variable would be instead:</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?layers=topp:states,topp:states&amp;styles=polygon,selection&amp;aparam=env:color&amp;avalues=FF0000,00FF00,0000FF</pre>
</div>
<p>which would generate an animated map whose selection color (coming from the color parameter and used in the selection style) would iterate between red, green and blue.</p>
<p>The animator would unpack the values, build the replacement parameter, kvp parse it and run the wms request which is then executed to generate one frame.
This of course might generate invalid requests, it&#8217;s up to the caller to ensure the request is valid.</p>
</div>
<div class="section" id="using-the-wms-animator">
<h2>Using the WMS Animator<a class="headerlink" href="#using-the-wms-animator" title="Permalink to this headline">¶</a></h2>
<p>To use the WMS Animator all one must do is specify <tt class="docutils literal"><span class="pre">wms/animate?</span></tt> as opposed to <tt class="docutils literal"><span class="pre">wms?</span></tt> in a request. The only mandatory parameters to a WMS Animator call are the <em class="guilabel">layers</em>, <em class="guilabel">aparam</em> and <em class="guilabel">avalues</em> parameters. As stated above the reflector fills in sensible defaults for the rest of the parameters. The following table lists all the defaults used:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>request</td>
<td>getmap</td>
</tr>
<tr class="row-even"><td>service</td>
<td>wms</td>
</tr>
<tr class="row-odd"><td>version</td>
<td>1.1.1</td>
</tr>
<tr class="row-even"><td>format</td>
<td>image/png</td>
</tr>
<tr class="row-odd"><td>width</td>
<td>512</td>
</tr>
<tr class="row-even"><td>height</td>
<td>512 if width is not specified</td>
</tr>
<tr class="row-odd"><td>srs</td>
<td>EPSG:4326</td>
</tr>
<tr class="row-even"><td>bbox</td>
<td>bounds of layer(s)</td>
</tr>
</tbody>
</table>
<p>Any of these defaults can be overridden when specifying the request. The <em class="guilabel">styles</em> parameter is derived by using the default style as configured by GeoServer for each <em class="guilabel">layer</em> specified in the layers parameter.</p>
<p>Any parameter you send with a WMS request is also legitimate when requesting data from the reflector. Its strength is what it does with the parameters you do not specify, which is explored in the next section.</p>
<p><strong>layers</strong>: This is the only mandatory parameter. It is a comma separated list of the layers you wish to include in your image or OpenLayers application.</p>
<p><strong>format</strong>: The default output format is image/png. Alternatives include image/jpeg (good for raster backgrounds), image/png8 (8 bit colors, smaller files) and image/gif</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In order to see an animation you need to use a format capable of handling it. At this time the only one enabled in GeoServer is <strong>image/gif;subtype=animated</strong></p>
</div>
<p><strong>width</strong>: Describes the width of the image, alternatively the size of the map in an OpenLayers. It defaults to 512 pixels and can be calculated based on the height and the aspect ratio of the bounding box.</p>
<p><strong>height</strong>: Describes the height of the image, alternatively the map in an OpenLayers. It can be calculated based on the width and the aspect ratio of the bounding box.</p>
<p><strong>bbox</strong>: The bounding box is automatically determined by taking the union of the bounds of the specified layers. In essence, it determines the extent of the map. By default, if you do not specify bbox, it will show you everything. If you have one layer of Los Angeles, and another of New York, it show you most of the United States. The bounding box, automatically set or specified, also determines the aspect ratio of the map. If you only specify one of width or height, the other will be determined based on the aspect ratio of the bounding box.</p>
<p><strong>styles</strong>: You can override the default styles by providing a comma separated list with the names of styles which must be known by the server.</p>
<p><strong>srs</strong>: The spatial reference system (SRS) parameter is somewhat difficult. If not specified the WMS Reflector will use EPSG:4326 / WGS84. It will support the native SRS of the layers as well, provided all layers share the same one.</p>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>Request the layer topp:states , it will come back with the default style (demographic), width (512 pixels) and height (adjusted to aspect ratio). The animation will have two frames one at wole world BBOX and another one around USA, giving the effect of zooming in.</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?layers=topp:states&amp;format=image/gif;subtype=animated&amp;aparam=bbox&amp;avalues=-180\,-90\,180\,90,-125\,25\,-67\,50</pre>
</div>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>Request the layers topp:states and sf:restricted, it will come back with the default styles, and the specified width (640 pixels) and the height automatically adjusted to the aspect ratio. The format_options will return an infinite loop animation.</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?layers=topp:states,sf:restricted&amp;format=image/gif;subtype=animated&amp;aparam=bbox&amp;avalues=-180\,-90\,180\,90,-125\,25\,-67\,50&amp;format_options=gif_loop_continuosly:true&amp;width=640</pre>
</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<p>Lets now rotate the image very fast and forever.</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?layers=topp:states,sf:restricted&amp;format=image/gif;subtype=animated&amp;aparam=angle&amp;avalues=0,45,90,135,180,225,270,365&amp;format_options=gif_loop_continuosly:true;gif_frames_delay:10&amp;width=640</pre>
</div>
</div>
</div>
<div class="section" id="adding-current-frame-values-as-text-overlays">
<h2>Adding current frame values as text overlays<a class="headerlink" href="#adding-current-frame-values-as-text-overlays" title="Permalink to this headline">¶</a></h2>
<p>It is possible to decorate each frame with the <tt class="docutils literal"><span class="pre">avalue</span></tt> that generated it using the <tt class="docutils literal"><span class="pre">text</span></tt> map decoration and having it exand the <tt class="docutils literal"><span class="pre">avalue</span></tt> parameter, which is fed into the <tt class="docutils literal"><span class="pre">env</span></tt> map while the animator runs (if needs be, the same value can also be used as a SLD parameter).
Here is an example call that uses a decoration:</p>
<div class="highlight-html"><pre>http://localhost:8080/geoserver/wms/animate?LAYERS=topp%3Aworld&amp;aparam=time&amp;avalues=2004-01-01T00:00:00.000Z,2004-02-01T00:00:00.000Z&amp;format=image/gif;subtype=animated&amp;format_options=layout:message</pre>
</div>
<p>which uses the following decoration layout, located in <tt class="docutils literal"><span class="pre">layouts/message.xml</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;layout&gt;</span>
  <span class="nt">&lt;decoration</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">affinity=</span><span class="s">&quot;bottom,right&quot;</span> <span class="na">offset=</span><span class="s">&quot;6,6&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span> <span class="na">value=</span><span class="s">&quot;${avalue}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;font-size&quot;</span> <span class="na">value=</span><span class="s">&quot;12&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;font-family&quot;</span> <span class="na">value=</span><span class="s">&quot;Arial&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;halo-radius&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/decoration&gt;</span>
<span class="nt">&lt;/layout&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="wms-animator-default-behaviour-through-wms-params">
<h2>WMS Animator default behaviour through WMS Params<a class="headerlink" href="#wms-animator-default-behaviour-through-wms-params" title="Permalink to this headline">¶</a></h2>
<p>The GeoServer amdinistrator GUI allows you also to setup some default parameters for the WMS Animator.</p>
<p>Going to Service &gt; WMS config panel, it&#8217;s possible to find the parameters as depicted below</p>
<div class="figure align-center">
<img alt="../_images/animator_wms_params.jpg" src="../_images/animator_wms_params.jpg" />
<p class="caption"><em>WMS Animator default settings</em></p>
</div>
<p>The first three options allows you to limit the animation requests. It&#8217;s possible to set the maximum number of frames an animation can contain, the maximum rendering time to produce an animation and the maximum size of the whole animation.</p>
<p>Also it&#8217;s possible to set the default animation behaviour in terms of frames delay (expressed in ms) and the loop.</p>
<p>The latters can be overridden using the format_options like in the Examples above.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="wmsreflector.html" title="previous chapter">WMS Reflector</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="cql/cql_tutorial.html" title="next chapter">CQL and ECQL</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">WMS Animator</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#using-the-wms-animator">Using the WMS Animator</a><ul>
<li><a class="reference internal" href="#example-1">Example 1</a></li>
<li><a class="reference internal" href="#example-2">Example 2</a></li>
<li><a class="reference internal" href="#example-3">Example 3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-current-frame-values-as-text-overlays">Adding current frame values as text overlays</a></li>
<li><a class="reference internal" href="#wms-animator-default-behaviour-through-wms-params">WMS Animator default behaviour through WMS Params</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="wmsreflector.html" title="previous chapter">WMS Reflector</a></li>
            <li>Next: <a href="cql/cql_tutorial.html" title="next chapter">CQL and ECQL</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../_sources/tutorials/animreflector.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>
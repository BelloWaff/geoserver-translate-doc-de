
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Monitor Configuration &mdash; GeoServer 2.2.x User Manual</title>
  <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.2.x',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
      <link rel="top" title="GeoServer 2.2.x User Manual" href="../../index.html" />
      <link rel="up" title="Monitoring" href="index.html" />
      <link rel="next" title="Logging all requests on the file system" href="audit.html" />
      <link rel="prev" title="Monitoring Overview" href="overview.html" />
</head>
<body class="community/monitoring/configuration">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.2.x User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/display/GEOS/What+is+Geoserver">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/display/GEOS/Download">Download</a></li>
        <li><a href="../../index.html">Documentation</a></li>
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.2.x User Manual</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Community</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Monitoring</a> &raquo;</li>
  <li>Monitor Configuration</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="audit.html" title="Logging all requests on the file system"
       accesskey="N">next</a></li>
  <li>
    <a href="overview.html" title="Monitoring Overview"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="monitor-configuration">
<span id="id1"></span><h1>Monitor Configuration<a class="headerlink" href="#monitor-configuration" title="Permalink to this headline">¶</a></h1>
<p>Many aspects of the monitor extension are configurable. All configuration files
are stored in the data directory under the <tt class="docutils literal"><span class="pre">monitoring</span></tt> directory:</p>
<div class="highlight-python"><pre>&lt;data_directory&gt;
    monitoring/
        db.properties
        filter.properties
        hibernate.properties
        monitor.properties</pre>
</div>
<p>The function of these files will be discussed below.</p>
<div class="section" id="monitor-mode">
<span id="id2"></span><h2>Monitor Mode<a class="headerlink" href="#monitor-mode" title="Permalink to this headline">¶</a></h2>
<p>The monitoring extension supports different &#8220;monitoring modes&#8221; that control how
request data is captured and stored. Currently three modes are supported:</p>
<blockquote>
<div><ul class="simple">
<li><strong>history</strong> <em>(Default)</em> - Only historical request information is available. No live information is maintained.</li>
<li><strong>live</strong> - Only information about live requests is maintained.</li>
<li><strong>mixed</strong> - A combination of live and history. This mode is experimental.</li>
</ul>
</div></blockquote>
<p>The mode is set in the <tt class="docutils literal"><span class="pre">monitor.properties</span></tt> file.</p>
<div class="section" id="history-mode">
<h3>History Mode<a class="headerlink" href="#history-mode" title="Permalink to this headline">¶</a></h3>
<p>History mode persists information about all requests in an external database. It
does not provide any real time information. This mode is appropriate in cases
where a user is most interested in analyzing request history over a given time
period.</p>
</div>
<div class="section" id="live-mode">
<h3>Live Mode<a class="headerlink" href="#live-mode" title="Permalink to this headline">¶</a></h3>
<p>Live mode only maintains short lived information about requests that are
currently executing. It also maintains a small buffer of recent requests. No
external database is used with this mode and no information is persisted for
the long term.</p>
<p>This mode is most appropriate in cases where a user only cares about what a
server is doing in real time and is not interested about request history.</p>
</div>
<div class="section" id="mixed-mode">
<h3>Mixed Mode<a class="headerlink" href="#mixed-mode" title="Permalink to this headline">¶</a></h3>
<p>Mixed mode combines both live and history mode in that it maintains both real
time information and persists all request data to the monitoring database. This
mode however is experimental and comes with more overhead than the other two
modes. This is because mixed mode must perform numerous database transactions
over the life cycle of a single request (in order to maintain live information),
whereas history mode only has to perform a single database transaction for a
request.</p>
<p>This mode is most appropriate when both real time request information and
request history are desired. This mode is also most appropriate in a clustered
server environment in which a user is interested in viewing real time request
information about multiple nodes in a cluster.</p>
</div>
</div>
<div class="section" id="bounding-box">
<h2>Bounding Box<a class="headerlink" href="#bounding-box" title="Permalink to this headline">¶</a></h2>
<p>The Bounding Box of requests can be logged.  By default, the box requested by WMS and WCS requests is logged.  Optionally this can be disabled, or a bounding box can be estimated for WFS requests.</p>
<p>The level of bounding box logging, and the CRS used for the log can both be set in the <tt class="docutils literal"><span class="pre">monitor.properties</span></tt> file.</p>
</div>
<div class="section" id="monitor-database">
<h2>Monitor Database<a class="headerlink" href="#monitor-database" title="Permalink to this headline">¶</a></h2>
<p>By default monitored request data is stored in an embedded H2 database located
in the <tt class="docutils literal"><span class="pre">monitoring</span></tt> directory. This can be changed by editing the
<tt class="docutils literal"><span class="pre">db.properties</span></tt> and <tt class="docutils literal"><span class="pre">hibernate.properties</span></tt> file:</p>
<div class="highlight-python"><pre># default configuration is for h2
driver=org.h2.Driver
url=jdbc:h2:file:${GEOSERVER_DATA_DIR}/monitoring/monitoring</pre>
</div>
<p>For example to store request data in an external PostgreSQL database, set <tt class="docutils literal"><span class="pre">db.properties</span></tt> to:</p>
<div class="highlight-python"><pre>driver=org.postgresql.Driver
url=jdbc:postgresql://192.168.1.124:5432/monitoring
username=bob
password=foobar
defaultAutoCommit=false</pre>
</div>
<p>and <tt class="docutils literal"><span class="pre">hibernate.properties</span></tt> to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">hibernate</span><span class="o">.</span><span class="n">use_sql_comments</span><span class="o">=</span><span class="n">true</span>
<span class="n">databasePlatform</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">hibernate</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">PostgreSQLDialect</span>
<span class="n">generateDdl</span><span class="o">=</span><span class="n">true</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">format_sql</span><span class="o">=</span><span class="n">true</span>
<span class="n">showSql</span><span class="o">=</span><span class="n">false</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">generate_statistics</span><span class="o">=</span><span class="n">true</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">session_factory_name</span><span class="o">=</span><span class="n">SessionFactory</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">hbm2ddl</span><span class="o">.</span><span class="n">auto</span><span class="o">=</span><span class="n">update</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">bytecode</span><span class="o">.</span><span class="n">use_reflection_optimizer</span><span class="o">=</span><span class="n">true</span>
<span class="n">database</span><span class="o">=</span><span class="n">POSTGRESQL</span>
<span class="n">hibernate</span><span class="o">.</span><span class="n">show_sql</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
<p>The maximum size of the request body that is logged is set in the <tt class="docutils literal"><span class="pre">monitor.properties</span></tt> and <tt class="docutils literal"><span class="pre">mappings.hbm.xml</span></tt> files. If the setting in <tt class="docutils literal"><span class="pre">monitor.properties</span></tt> is higher than that in <tt class="docutils literal"><span class="pre">mappings.hbm.xml</span></tt> any long requests will fail to be logged entirely.  You can set it to be unbounded if your database supports it.</p>
</div>
<div class="section" id="request-filters">
<h2>Request Filters<a class="headerlink" href="#request-filters" title="Permalink to this headline">¶</a></h2>
<p>By default not all requests are monitored. Those requests excluded include any web admin requests or any <a class="reference internal" href="http.html#monitor-http-api"><em>Monitoring HTTP API</em></a> requests. These exclusions are configured in the <tt class="docutils literal"><span class="pre">filter.properties</span></tt> file:</p>
<div class="highlight-python"><pre>/rest/monitor/**
/web/**</pre>
</div>
<p>These default filters can be changed or extended to filter more types of
requests. For example to filter out all WFS requests:</p>
<div class="highlight-python"><pre>/wfs</pre>
</div>
<div class="section" id="how-to-determine-the-filter-path">
<h3>How to determine the filter path<a class="headerlink" href="#how-to-determine-the-filter-path" title="Permalink to this headline">¶</a></h3>
<p>The contents of <tt class="docutils literal"><span class="pre">filter.properties</span></tt> are a series of ant-style patterns that
are applied to the <em>path</em> of the request. Consider the following request:</p>
<div class="highlight-python"><pre>http://localhost:8080/geoserver/wms?request=getcapabilities</pre>
</div>
<p>The path of the above request is <tt class="docutils literal"><span class="pre">/wms</span></tt>. In the following request:</p>
<div class="highlight-python"><pre>http://localhost:8080/geoserver/rest/workspaces/topp/datastores.xml</pre>
</div>
<p>The path is <tt class="docutils literal"><span class="pre">/rest/workspaces/topp/datastores.xml</span></tt>.</p>
<p>In general, the path used in filters is comprised of the portion of the URL
after <tt class="docutils literal"><span class="pre">/geoserver</span></tt> (including the preceding <tt class="docutils literal"><span class="pre">/</span></tt>) and before the query string <tt class="docutils literal"><span class="pre">?</span></tt>:</p>
<div class="highlight-python"><pre>http://&lt;host&gt;:&lt;port&gt;/geoserver/&lt;path&gt;?&lt;queryString&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information about ant-style pattern matching, see the <a class="reference external" href="http://ant.apache.org/manual/dirtasks.html">Apache Ant manual</a>.</p>
</div>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="overview.html" title="previous chapter">Monitoring Overview</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="audit.html" title="next chapter">Logging all requests on the file system</a></div>
      </div>
      </div><!-- /#content> -->
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Monitor Configuration</a><ul>
<li><a class="reference internal" href="#monitor-mode">Monitor Mode</a><ul>
<li><a class="reference internal" href="#history-mode">History Mode</a></li>
<li><a class="reference internal" href="#live-mode">Live Mode</a></li>
<li><a class="reference internal" href="#mixed-mode">Mixed Mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bounding-box">Bounding Box</a></li>
<li><a class="reference internal" href="#monitor-database">Monitor Database</a></li>
<li><a class="reference internal" href="#request-filters">Request Filters</a><ul>
<li><a class="reference internal" href="#how-to-determine-the-filter-path">How to determine the filter path</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="overview.html" title="previous chapter">Monitoring Overview</a></li>
            <li>Next: <a href="audit.html" title="next chapter">Logging all requests on the file system</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../../_sources/community/monitoring/configuration.txt">Show Source</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright GeoServer.
    Last updated on Jan 04, 2013.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>